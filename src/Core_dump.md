# core dump文件

- **Tips-63:** 为调试进程产生core dump文件

**技巧：**
在用gdb调试程序时，我们有时想让被调试的进程产生`core dump`文件，记录现在进程的状态，以供以后分析。可以用`generate-core-file`命令来产生`core dump`文件：

```shell
(gdb) help generate-core-file
Save a core file with the current state of the debugged process.
Argument is optional filename.  Default filename is 'core.<process_id>'.

(gdb) start
Temporary breakpoint 1 at 0x8050c12: file a.c, line 9.
Starting program: /data1/nan/a
[Thread debugging using libthread_db enabled]
[New Thread 1 (LWP 1)]
[Switching to Thread 1 (LWP 1)]

Temporary breakpoint 1, main () at a.c:9
9           change_var();
(gdb) generate-core-file
Saved corefile core.12955
```

也可使用`gcore`命令：
```shell
(gdb) help gcore
Save a core file with the current state of the debugged process.
Argument is optional filename.  Default filename is 'core.<process_id>'.
(gdb) gcore
Saved corefile core.13256
```


- **Tips-64:** 加载可执行程序和core dump文件

**示例代码：**

```c
#include <stdio.h>

int main(void) {
        int *p = NULL;
        printf("hello world\n");
        *p = 0;
        return 0;
}
```

**技巧：**
例子程序访问了一个空指针，所以程序会`crash`并产生`core dump`文件。用gdb调试`core dump`文件，通常用这个命令形式：`gdb path/to/the/executable path/to/the/coredump`，然后gdb会显示程序`crash`的位置：

```shell
bash-3.2# gdb -q /data/nan/a /var/core/core.a.22268.1402638140
Reading symbols from /data/nan/a...done.
[New LWP 1]
[Thread debugging using libthread_db enabled]
[New Thread 1 (LWP 1)]
Core was generated by `./a'.
Program terminated with signal 11, Segmentation fault.
#0  0x0000000000400cdb in main () at a.c:6
6               *p = 0;
```

有时我们想在gdb启动后，动态加载可执行程序和`core dump`文件，这时可以用`file`和`core`(`core-file`)命令缩写）命令。`file`命令用来读取可执行文件的符号表信息，而`core`命令则是指定`core dump`文件的位置：

```shell
bash-3.2# gdb -q
(gdb) file /data/nan/a
Reading symbols from /data/nan/a...done.
(gdb) core /var/core/core.a.22268.1402638140
[New LWP 1]
[Thread debugging using libthread_db enabled]
[New Thread 1 (LWP 1)]
Core was generated by `./a'.
Program terminated with signal 11, Segmentation fault.
#0  0x0000000000400cdb in main () at a.c:6
6               *p = 0;
```

可以看到gdb同样显示程序`crash`的位置。


